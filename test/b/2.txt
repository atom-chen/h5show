1   precision mediump float;
2   uniform sampler2D fs0;
3   uniform sampler2D fs1;
4   uniform sampler2D fs2;
5   uniform samplerCube fs3;
6   uniform vec4 fc[2];
7   varying vec2 v0;
8   varying vec3 v1;
9   varying mat3 v4;
10  void main(void){
11  
12  vec4 ft0 = texture2D(fs0,v0);
13  vec4 ft1 = vec4(0,0,0,1);
14  ft1.xyz = ft0.xyz * fc[1].x;
15  ft0 = texture2D(fs1,v0);
16  vec4 ft2 = vec4(ft1.xyz,1.0);
17  vec4 ft3 = vec4(0,0,0,1);
18  ft3.xyz = ft0.xyz * 2.0 - 1.0;
19  ft3.xyz = v4 * ft3.xyz;
20  ft3.xyz = normalize(ft3.xyz);
21  ft0.xyz = mix(vec3(fc[1].y,fc[1].y,fc[1].y) * 0.08,ft2.xyz,0.5);
22  vec4 ft4 = vec4(0,0,0,1);
23  ft4.xyz = fc[0].xyz - v1.xyz;
24  ft4.xyz = normalize(ft4.xyz);
25  ft4.y= dot(ft4.xyz,ft3.xyz);
26  ft4.x = 0.5;
27  ft4 = texture2D(fs2,ft4.xy);
28  ft0.xyz = ft0.xyz * ft4.x + ft4.y;
29  ft0.xyz = ft0.xyz * fc[1].y;
30  ft4.xyz = v1.xyz - fc[0].xyz;
31  ft4.xyz = normalize(ft4.xyz);
32  ft4.xyz = reflect(ft4.xyz,ft3.xyz);
33  ft4 = textureCube(fs3,ft4.xyz);
34  ft0.xyz = ft0.xyz * ft4.xyz;
35  ft4.xyz = ft2.xyz * 0.5;
36  ft4.xyz = ft4.xyz + ft0.xyz;
37  ft4.w = 1.0;
38  gl_FragColor = ft4;
39  
40  }